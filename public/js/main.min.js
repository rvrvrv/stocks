'use strict';var chart,socket=io(),stockData={};$(document).ready(function(){socket.on('deleted',function(a){removeStock(a)}),socket.on('added',function(a){addStock(a.addedStockData)}),socket.on('newClientConnect',function(a){stockData=a.stockData;var b=0;for(var c in stockData)seriesOptions[b]={name:c,id:c,data:stockData[c]},generateHTML(c),b++;chart=Highcharts.stockChart('chart',chartConfig),$('#chart').addClass('fadeIn'),$('.progress').addClass('hidden'),$('#chart').css('background-image','none')})});function generateHTML(a){$('.modals').append('\n\t\t\t<div id="del'+a+'" class="modal">\n\t\t\t\t<div class="modal-content">\n\t\t\t\t\t<h4>Delete '+a+'</h4>\n\t\t\t\t\t<p>Are you sure you want to remove '+a+'?</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="modal-footer">\n\t\t\t\t\t<a class="modal-action modal-close waves-effect waves-green btn-flat">No</a>\n\t\t\t\t\t<a class="modal-action modal-close waves-effect waves-red btn-flat del-btn" data-stock="'+a+'">Yes</a>\n\t\t\t\t</div>\n\t\t\t</div>'),$('.modal').modal(),$('.stock-cards').append('\n\t\t\t<div class="col s6 m4 animated" id="'+a+'">\n\t\t\t\t<div class="card grey darken-4 z-depth-3">\n\t\t\t\t\t<div class="card-content white-text center">\n\t\t\t\t\t\t<span class="card-title">'+a+'</span>\n\t\t\t\t\t\t<a class="btn-floating waves-effect tooltipped indigo darken-3" data-position="bottom" data-tooltip="Learn about '+a+'" href="https://www.google.com/finance?q='+a+'" target="_blank"><i class="material-icons info-icon">info</i></a>\n\t\t\t\t\t\t<a class="btn-floating waves-effect modal-trigger tooltipped red darken-4" data-position="bottom" data-tooltip="Remove '+a+'" href="#del'+a+'"><i class="material-icons del-icon">delete</i></a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>'),$('.tooltipped').tooltip({delay:100})}function removeStock(a){$('#'+a).length&&($('#'+a).addClass('fadeOut'),setTimeout(function(){return $('#'+a).remove()},1e3),$('#del'+a).remove(),chart.get(a).remove())}function addStock(a){if(!a)return enableInput('No stock data found.');var b=Object.keys(a)[0];$('#'+b).length||(generateHTML(b),chart.addSeries({name:b,id:b,data:a[b]}),enableInput())}function enableInput(a){a&&Materialize.toast(a,3500,'red darken-2'),$('#addStock :input').prop('disabled',!1),$('.progress').addClass('hidden'),chart.hideLoading()}$('.modals').on('click','.del-btn',function(){var a=$(this).attr('data-stock');removeStock(a),socket.emit('deleteStock',a)}),$('#addStock').on('submit',function(a){a.preventDefault(),chart.showLoading(),$('.progress').removeClass('hidden'),$('#addStock :input').prop('disabled',!0);var b=$('#stockInput').val().trim().toUpperCase();return /[^A-Z]/.test(b)||!b?enableInput('Please enter a valid ticker symbol'):0<$('#'+b).length?enableInput(b+' is already on the chart.<br> Please enter a new ticker symbol.'):void socket.emit('addStock',b)});var seriesOptions=[],chartConfig={colors:['#55b209','#003aff','#ff5319','#ffc200','#b21409','#a712b2','#09b28d','#6818cc','#b29900','#49f6ff','#009cff','#cc2323'],chart:{backgroundColor:'#212121',style:{color:'#A2A39C'}},legend:{align:'right',verticalAlign:'bottom',itemStyle:{fontWeight:'normal',color:'#A2A39C'}},plotLines:[{value:0,width:2,color:'silver'}],plotOptions:{series:{compare:'percent',showInNavigator:!0}},rangeSelector:{selected:4},tooltip:{backgroundColor:'#fff',pointFormat:'<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',valueDecimals:2,split:!0,xDateFormat:'%a, %B %e'},xAxis:{gridLineDashStyle:'Dot',gridLineWidth:1,gridLineColor:'#A2A39C',lineColor:'#A2A39C',minorGridLineColor:'#A2A39C',tickColor:'#A2A39C',tickWidth:1},yAxis:{gridLineDashStyle:'Dot',gridLineColor:'#A2A39C',lineColor:'#A2A39C',minorGridLineColor:'#A2A39C',tickColor:'#A2A39C',tickWidth:1,labels:{formatter:function formatter(){return(0<this.value?' + ':'')+this.value+'%'}}},series:seriesOptions};
